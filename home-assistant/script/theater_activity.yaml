alias: Theater Activity
mode: restart
fields:
  activity:
    selector:
      select:
        options:
          - All Off
          - Plex
          - YouTube
          - Shield Home
          - Shield App
          - Blu-Ray
          - Music
          - AUX
    name: Activity
    required: true
    default: All Off
sequence:
  - if:
      - condition: template
        value_template: "{{ activity in ['All Off'] }}"
    then:
      - parallel:
          - service: script.theater_lights
            data:
              scene: Room
          - service: climate.turn_off
            target:
              area_id: theater
          - service: remote.turn_off
            target:
              entity_id: remote.theater_projector
          - service: media_player.turn_off
            target:
              entity_id:
                - media_player.theater
    else:
      - parallel:
          - alias: Climate
            if:
              - condition: state
                entity_id: climate.theater_climate
                state: "off"
            then:
              - service: climate.turn_on
                target:
                  area_id:
                    - theater
          - alias: Lights
            service: script.theater_lights
            data:
              scene: Standby
          - alias: Preamp
            sequence:
              - service: media_player.turn_on
                target:
                  entity_id:
                    - media_player.theater
              - service: media_player.select_source
                target:
                  entity_id: media_player.theater_preamp_zone_1
                data:
                  source: >-
                    {{
                      {
                        'Plex' : 'UHD',
                        'YouTube' : 'UHD',
                        'Shield Home' : 'UHD',
                        'Shield App' : 'UHD',
                        'Blu-Ray' : 'BD',
                        'Music' : 'NET',
                        'AUX' : 'AUX',
                      }[activity]
                    }}
          - alias: Shield
            choose:
              - alias: Plex
                conditions:
                  - condition: template
                    value_template: "{{ activity in ['Plex'] }}"
                sequence:
                  - service: media_player.turn_on
                    target:
                      entity_id: media_player.theater_shield
                  - service: media_player.play_media
                    target:
                      entity_id: media_player.theater_shield_remote
                    data:
                      media_content_type: url
                      media_content_id: plex://
              - alias: YouTube
                conditions:
                  - condition: template
                    value_template: "{{ activity in ['YouTube'] }}"
                sequence:
                  - service: media_player.turn_on
                    target:
                      entity_id: media_player.theater_shield
                  - service: media_player.play_media
                    target:
                      entity_id: media_player.theater_shield_remote
                    data:
                      media_content_type: url
                      media_content_id: vnd.youtube://
              - alias: Shield Home
                conditions:
                  - condition: template
                    value_template: "{{ activity in ['Shield Home'] }}"
                sequence:
                  - service: media_player.turn_on
                    target:
                      entity_id: media_player.theater_shield
                  - service: remote.send_command
                    target:
                      entity_id: remote.theater_shield_remote
                    data:
                      command: HOME
              - alias: Shield App
                conditions:
                  - condition: template
                    value_template: "{{ activity in ['Shield App'] }}"
                sequence:
                  - service: media_player.turn_on
                    target:
                      entity_id: media_player.theater_shield
            default:
              - service: media_player.turn_off
                target:
                  entity_id:
                    - media_player.theater_shield
          - alias: Blu-ray
            service: |-
              {% if activity in ['Blu-Ray'] -%}
                media_player.turn_on
              {%- else -%}
                media_player.turn_off
              {%- endif %}
            target:
              entity_id: media_player.theater_bluray
          - alias: Projector
            if:
              - condition: template
                value_template: "{{ activity in ['Music'] }}"
            then:
              - if:
                  - condition: state
                    entity_id: remote.theater_projector
                    state: "on"
                then:
                  - service: remote.turn_off
                    target:
                      entity_id: remote.theater_projector
            else:
              - if:
                  - condition: state
                    entity_id: remote.theater_projector
                    state: "off"
                then:
                  - service: remote.turn_on
                    target:
                      entity_id:
                        - remote.theater_projector
